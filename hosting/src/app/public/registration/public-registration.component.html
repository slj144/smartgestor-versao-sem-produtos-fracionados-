<!-- 
Arquivo: public-registration.component.html
Caminho: src/app/public/registration/public-registration.component.html
O que faz: Template HTML do formul√°rio p√∫blico com visual melhorado
-->

<div class="public-registration-page">
    <!-- Estado de carregamento -->
    <div class="loading-container" *ngIf="loading">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>Carregando...</p>
        </div>
    </div>

    <!-- Estado de erro -->
    <div class="error-container" *ngIf="hasError && !loading">
        <div class="error-card">
            <div class="error-icon">‚ùå</div>
            <h2>üòï Ops! Algo deu errado üòï</h2>
            <p>{{ errorMessage }}</p>
            <button class="btn btn-primary" (click)="resetForm()">
                Tentar Novamente
            </button>
        </div>
    </div>

    <!-- Formul√°rio principal -->
    <div class="registration-container" *ngIf="!loading && !hasError && !submitted">

        <div class="registration-card">
            <!-- Cabe√ßalho com t√≠tulo -->
            <div class="card-header">
                <!-- Nome da empresa -->
                <h1 class="company-name">üè¢ {{ tenantInfo?.name || 'Nossa Empresa' }}</h1>

                <!-- T√≠tulo e subt√≠tulo -->
                <h2 class="form-title">‚ú® {{ formSettings?.appearance?.title || 'Cadastre-se' }}</h2>
                <p class="form-subtitle">üéâ {{ formSettings?.appearance?.subtitle || 'Preencha seus dados e aproveite nossas ofertas exclusivas' }}</p>

                <!-- Badge de desconto especial -->
                <div class="discount-badge" *ngIf="formSettings?.appearance?.showDiscount">
                    <span class="badge-icon">üéâ</span>
                    <span class="badge-text">Desconto especial para novos clientes!</span>
                </div>
            </div>

            <!-- Formul√°rio -->
            <form [formGroup]="registrationForm" (ngSubmit)="onSubmit()" class="registration-form">
                <!-- Indicador de campos obrigat√≥rios -->
                <div class="required-info">
                    <span class="required-star">*</span> Campos obrigat√≥rios
                </div>

                <!-- Nome -->
                <div class="form-group" *ngIf="formSettings?.fields?.name?.show">
                    <label class="form-label">
                        <span class="label-icon">üë§</span>
                        {{ formSettings.fields.name.label }}
                        <span class="required" *ngIf="formSettings.fields.name.required">*</span>
                    </label>
                    <input type="text" class="form-control" formControlName="name"
                        placeholder="Digite seu nome completo"
                        [class.error]="registrationForm.get('name')?.invalid && registrationForm.get('name')?.touched">

                    <!-- Mensagem de erro padronizada -->
                    <div class="error-message"
                        *ngIf="registrationForm.get('name')?.invalid && registrationForm.get('name')?.touched">
                        <span *ngIf="registrationForm.get('name')?.errors?.['required']">
                            Este campo √© obrigat√≥rio
                        </span>
                    </div>
                </div>

                <!-- Telefone -->
                <div class="form-group" *ngIf="formSettings?.fields?.phone?.show">
                    <label class="form-label">
                        <span class="label-icon">üì±</span>
                        {{ formSettings.fields.phone.label }}
                        <span class="required" *ngIf="formSettings.fields.phone.required">*</span>
                    </label>
                    <input type="text" class="form-control" formControlName="phone" (input)="applyPhoneMask($event)"
                        placeholder="(00) 00000-0000"
                        [class.error]="registrationForm.get('phone')?.invalid && registrationForm.get('phone')?.touched">

                    <!-- Mensagem de erro padronizada -->
                    <div class="error-message"
                        *ngIf="registrationForm.get('phone')?.invalid && registrationForm.get('phone')?.touched">
                        <span *ngIf="registrationForm.get('phone')?.errors?.['required']">
                            Este campo √© obrigat√≥rio
                        </span>
                        <span *ngIf="registrationForm.get('phone')?.errors?.['phoneAlreadyExists']">
                            Este telefone j√° est√° cadastrado
                        </span>
                    </div>
                </div>
                <!-- E-mail -->
                <div class="form-group" *ngIf="formSettings?.fields?.email?.show">
                    <label class="form-label">
                        <span class="label-icon">‚úâÔ∏è</span>
                        {{ formSettings.fields.email.label }}
                        <span class="required" *ngIf="formSettings.fields.email.required">*</span>
                        <span class="optional-badge" *ngIf="!formSettings.fields.email.required">Opcional</span>
                    </label>
                    <input type="email" class="form-control" formControlName="email" placeholder="seu@email.com"
                        [class.error]="registrationForm.get('email')?.invalid && registrationForm.get('email')?.touched">

                    <!-- Mensagem de erro padronizada -->
                    <div class="error-message"
                        *ngIf="registrationForm.get('email')?.invalid && registrationForm.get('email')?.touched">
                        <span *ngIf="registrationForm.get('email')?.errors?.['required']">
                            Este campo √© obrigat√≥rio
                        </span>
                        <span *ngIf="registrationForm.get('email')?.errors?.['email']">
                            E-mail inv√°lido
                        </span>
                    </div>
                </div>

                <!-- CPF -->
                <div class="form-group" *ngIf="formSettings?.fields?.cpf?.show">
                    <label class="form-label">
                        <span class="label-icon">üÜî</span>
                        {{ formSettings.fields.cpf.label }}
                        <span class="required" *ngIf="formSettings.fields.cpf.required">*</span>
                        <span class="optional-badge" *ngIf="!formSettings.fields.cpf.required">Opcional</span>
                    </label>
                    <input type="text" class="form-control" formControlName="cpf" (input)="applyCpfMask($event)"
                        placeholder="000.000.000-00"
                        [class.error]="registrationForm.get('cpf')?.invalid && registrationForm.get('cpf')?.touched">

                    <!-- Mensagem de erro padronizada -->
                    <div class="error-message"
                        *ngIf="registrationForm.get('cpf')?.invalid && registrationForm.get('cpf')?.touched">
                        <span *ngIf="registrationForm.get('cpf')?.errors?.['required']">
                            Este campo √© obrigat√≥rio
                        </span>
                        <span *ngIf="registrationForm.get('cpf')?.errors?.['cpfAlreadyExists']">
                            Este CPF j√° est√° cadastrado
                        </span>
                    </div>
                </div>
                <!-- Data de Nascimento -->
                <div class="form-group" *ngIf="formSettings?.fields?.birthDate?.show">
                    <label class="form-label">
                        <span class="label-icon">üéÇ</span>
                        {{ formSettings.fields.birthDate.label }}
                        <span class="required" *ngIf="formSettings.fields.birthDate.required">*</span>
                        <span class="optional-badge" *ngIf="!formSettings.fields.birthDate.required">Opcional</span>
                    </label>
                    <input type="date" class="form-control" formControlName="birthDate"
                        [class.error]="registrationForm.get('birthDate')?.invalid && registrationForm.get('birthDate')?.touched">

                    <!-- Mensagem de erro padronizada -->
                    <div class="error-message"
                        *ngIf="registrationForm.get('birthDate')?.invalid && registrationForm.get('birthDate')?.touched">
                        <span *ngIf="registrationForm.get('birthDate')?.errors?.['required']">
                            Este campo √© obrigat√≥rio
                        </span>
                    </div>
                </div>
                <!-- Endere√ßo (OPCIONAL) -->
                <div class="form-group address-section" *ngIf="formSettings?.fields?.address?.show">
                    <label class="form-label">
                        <span class="label-icon">üìç</span>
                        {{ formSettings.fields.address.label }}
                        <span class="optional-badge">Opcional</span>
                    </label>

                    <div class="address-group" formGroupName="address">
                        <!-- CEP -->
                        <div class="address-row">
                            <div class="cep-field">
                                <input type="text" class="form-control" formControlName="postalCode"
                                    (input)="applyPostalCodeMask($event)" (blur)="searchAddress()"
                                    placeholder="CEP: 00000-000">
                                <button type="button" class="btn-search-cep" (click)="searchAddress()"
                                    [disabled]="searchingCep">
                                    <span *ngIf="!searchingCep">üîç</span>
                                    <span *ngIf="searchingCep" class="mini-spinner"></span>
                                </button>
                            </div>
                        </div>

                        <!-- Rua e N√∫mero -->
                        <div class="address-row">
                            <input type="text" class="form-control flex-grow" formControlName="local"
                                placeholder="Rua, Avenida, etc.">
                            <input type="text" class="form-control address-number" formControlName="number"
                                placeholder="N¬∫">
                        </div>

                        <!-- Complemento -->
                        <div class="address-row">
                            <input type="text" class="form-control" formControlName="complement"
                                placeholder="Complemento (Apto, Sala, etc.)">
                        </div>

                        <!-- Bairro -->
                        <div class="address-row">
                            <input type="text" class="form-control" formControlName="neighborhood" placeholder="Bairro">
                        </div>

                        <!-- Cidade e Estado -->
                        <div class="address-row">
                            <input type="text" class="form-control flex-grow" formControlName="city"
                                placeholder="Cidade">
                            <input type="text" class="form-control address-state" formControlName="state"
                                placeholder="UF" maxlength="2">
                        </div>
                    </div>
                </div>

                <!-- Termos de uso (se habilitado) -->
                <div class="form-group terms-group" *ngIf="formSettings?.security?.showTerms">
                    <label class="checkbox-label">
                        <input type="checkbox" formControlName="acceptTerms" class="checkbox-input">
                        <span class="checkbox-text">
                            Li e aceito os
                            <a href="#" target="_blank" class="terms-link">termos de uso</a>
                            e a
                            <a href="#" target="_blank" class="terms-link">pol√≠tica de privacidade</a>
                        </span>
                    </label>
                </div>

                <!-- Bot√£o de envio -->
                <button type="submit" class="btn-submit" [disabled]="submitting || registrationForm.invalid"
                    [class.loading]="submitting">
                    <span *ngIf="!submitting">
                        <span class="btn-icon">üöÄ</span>
                        Cadastrar e Garantir Desconto
                        <span class="btn-icon">üéÅ</span>
                    </span>
                    <span *ngIf="submitting">
                        <span class="mini-spinner"></span>
                        Cadastrando...
                    </span>
                </button>

                <!-- Aviso de seguran√ßa -->
                <div class="security-notice">
                    <span class="lock-icon">üîí</span>
                    Seus dados est√£o seguros e protegidos
                </div>
            </form>
        </div>

        <!-- Footer -->
        <div class="registration-footer">
            <p>¬© {{ currentYear }} {{ tenantInfo?.name || 'Nossa Empresa' }}. Todos os direitos reservados.</p>
            <p class="footer-security">
                <span class="lock-icon">üîí</span>
                Ambiente seguro e protegido
            </p>
        </div>
    </div>

    <!-- Estado de sucesso -->
    <div class="success-container" *ngIf="submitted && !loading">
        <div class="success-card">
            <div class="success-animation">
                <div class="success-icon">‚úÖ</div>
                <div class="confetti">üéâ</div>
            </div>
            <h2>üéä Parab√©ns! Cadastro realizado com sucesso! üéä</h2>
            <p class="success-message">
                üéÅ {{ formSettings?.appearance?.successMessage || 'Voc√™ garantiu seu desconto especial!' }} üéÅ
            </p>
            <div class="success-info">
                <p>üìû Em breve entraremos em contato com mais informa√ß√µes.</p>
                <p class="discount-info">
                    <strong>üíØ Seu desconto foi garantido! üíØ</strong><br>
                    üì± Guarde seu telefone cadastrado para aproveitar na pr√≥xima compra.
                </p>
            </div>
            <button class="btn btn-primary" (click)="resetForm()">
                Fazer Novo Cadastro
            </button>
        </div>
    </div>
</div>
