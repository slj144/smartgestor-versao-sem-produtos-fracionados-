<!-- 
Arquivo: public-link-manager.component.html
Caminho: src/app/pages/crm/components/public-link-manager/public-link-manager.component.html
O que faz: Interface para o admin configurar o formul√°rio p√∫blico
-->

<div class="public-link-manager">
    <!-- Cabe√ßalho com o link e QR Code -->
    <div class="link-section">
        <h2>üîó Link P√∫blico de Cadastro</h2>

        <div class="link-display">
            <input type="text" [value]="publicLink" readonly class="link-input">
            <button (click)="copyLink()" class="btn-copy">üìã Copiar</button>
            <button (click)="generateQRCode()" class="btn-qr">üì± QR Code</button>
        </div>

        <!-- QR Code (aparece quando clica no bot√£o) -->
        <div *ngIf="showQRCode" class="qr-code-section">
            <div id="qrcode"></div>
            <p>Escaneie com o celular para acessar</p>
        </div>
    </div>

    <!-- Se√ß√£o de Configura√ß√µes da Empresa -->
    <div class="company-section">
        <h2>üè¢ Nome da Empresa</h2>
        <p class="help-text">Configure o nome que aparecer√° na p√°gina de cadastro</p>

        <div class="company-name-section">
            <label>Nome da Empresa</label>
            <input type="text" [(ngModel)]="companyName" placeholder="Digite o nome da sua empresa" class="company-input">
            <button type="button" class="save-company-btn" (click)="saveCompanyInfo()">üíæ Salvar Nome</button>
        </div>
    </div>

    <!-- Se√ß√£o de Configura√ß√µes do Formul√°rio -->
    <div class="settings-section" *ngIf="settingsForm">
        <h2>‚öôÔ∏è Configurar Campos do Formul√°rio</h2>
        <p class="help-text">Escolha quais campos aparecem no formul√°rio p√∫blico e se s√£o obrigat√≥rios</p>

        <form [formGroup]="settingsForm">
            <!-- Configura√ß√£o dos Campos -->
            <div class="fields-config" formGroupName="fields">

                <!-- Campo NOME -->
                <div class="field-item" formGroupName="name">
                    <div class="field-header">
                        <label class="field-toggle">
                            <input type="checkbox" formControlName="show">
                            <span class="toggle-slider"></span>
                            <span class="field-name">üìù Nome Completo</span>
                        </label>
                    </div>
                    <div class="field-options" *ngIf="settingsForm.get('fields.name.show')?.value">
                        <label>
                            <input type="checkbox" formControlName="required">
                            Obrigat√≥rio
                        </label>
                        <input type="text" formControlName="label" placeholder="Texto do campo">
                    </div>
                </div>

                <!-- Campo EMAIL -->
                <div class="field-item" formGroupName="email">
                    <div class="field-header">
                        <label class="field-toggle">
                            <input type="checkbox" formControlName="show">
                            <span class="toggle-slider"></span>
                            <span class="field-name">üìß E-mail</span>
                        </label>
                    </div>
                    <div class="field-options" *ngIf="settingsForm.get('fields.email.show')?.value">
                        <label>
                            <input type="checkbox" formControlName="required">
                            Obrigat√≥rio
                        </label>
                        <input type="text" formControlName="label" placeholder="Texto do campo">
                    </div>
                </div>

                <!-- Campo TELEFONE -->
                <div class="field-item" formGroupName="phone">
                    <div class="field-header">
                        <label class="field-toggle">
                            <input type="checkbox" formControlName="show">
                            <span class="toggle-slider"></span>
                            <span class="field-name">üì± Telefone</span>
                        </label>
                    </div>
                    <div class="field-options" *ngIf="settingsForm.get('fields.phone.show')?.value">
                        <label>
                            <input type="checkbox" formControlName="required">
                            Obrigat√≥rio (sempre)
                        </label>
                        <input type="text" formControlName="label" placeholder="Texto do campo">
                    </div>
                </div>

                <!-- Campo CPF -->
                <div class="field-item" formGroupName="cpf">
                    <div class="field-header">
                        <label class="field-toggle">
                            <input type="checkbox" formControlName="show">
                            <span class="toggle-slider"></span>
                            <span class="field-name">üÜî CPF</span>
                        </label>
                    </div>
                    <div class="field-options" *ngIf="settingsForm.get('fields.cpf.show')?.value">
                        <label>
                            <input type="checkbox" formControlName="required">
                            Obrigat√≥rio
                        </label>
                        <input type="text" formControlName="label" placeholder="Texto do campo">
                    </div>
                </div>

                <!-- Campo DATA DE NASCIMENTO -->
                <div class="field-item" formGroupName="birthDate">
                    <div class="field-header">
                        <label class="field-toggle">
                            <input type="checkbox" formControlName="show">
                            <span class="toggle-slider"></span>
                            <span class="field-name">üéÇ Data de Nascimento</span>
                        </label>
                    </div>
                    <div class="field-options" *ngIf="settingsForm.get('fields.birthDate.show')?.value">
                        <label>
                            <input type="checkbox" formControlName="required">
                            Obrigat√≥rio
                        </label>
                        <input type="text" formControlName="label" placeholder="Texto do campo">
                    </div>
                </div>

                <!-- Campo ENDERE√áO -->
                <div class="field-item" formGroupName="address">
                    <div class="field-header">
                        <label class="field-toggle">
                            <input type="checkbox" formControlName="show">
                            <span class="toggle-slider"></span>
                            <span class="field-name">üìç Endere√ßo Completo</span>
                        </label>
                    </div>
                    <div class="field-options" *ngIf="settingsForm.get('fields.address.show')?.value">
                        <label>
                            <input type="checkbox" formControlName="required">
                            Obrigat√≥rio
                        </label>
                        <input type="text" formControlName="label" placeholder="Texto do campo">
                        <p class="info-text">
                            ‚ÑπÔ∏è Inclui: CEP, Rua, N√∫mero, Complemento, Bairro, Cidade e Estado
                        </p>
                    </div>
                </div>
            </div>

            <!-- Configura√ß√µes de Apar√™ncia -->
            <div class="appearance-config" formGroupName="appearance">
                <h3>üé® Apar√™ncia do Formul√°rio</h3>



                <div class="config-item">
                    <label>T√≠tulo do formul√°rio:</label>
                    <input type="text" formControlName="title" placeholder="Ex: Cadastre-se">
                </div>

                <div class="config-item">
                    <label>Subt√≠tulo:</label>
                    <input type="text" formControlName="subtitle"
                        placeholder="Ex: Preencha seus dados para se cadastrar">
                </div>

                <div class="config-item">
                    <label>Mensagem de sucesso:</label>
                    <textarea formControlName="successMessage"
                        placeholder="Ex: Cadastro realizado com sucesso!"></textarea>
                </div>
            </div>

            <!-- Bot√µes de a√ß√£o -->
            <div class="actions">
                <button type="button" (click)="saveSettings()" class="btn-save" [disabled]="loading">
                    <span *ngIf="!loading">üíæ Salvar Configura√ß√µes</span>
                    <span *ngIf="loading">‚è≥ Salvando...</span>
                </button>
                <button type="button" (click)="previewForm()" class="btn-preview">
                    üëÅÔ∏è Visualizar Formul√°rio
                </button>
            </div>
        </form>
    </div>

    <!-- Estat√≠sticas -->
    <div class="statistics-section">
        <h3>üìä Estat√≠sticas de Cadastros</h3>
        <div class="stats-grid">
            <div class="stat-card">
                <span class="stat-value">{{ statistics.totalRegistrations }}</span>
                <span class="stat-label">Total de Cadastros</span>
            </div>
            <div class="stat-card">
                <span class="stat-value">{{ statistics.todayRegistrations }}</span>
                <span class="stat-label">Cadastros Hoje</span>
            </div>
            <div class="stat-card">
                <span class="stat-value">{{ statistics.weekRegistrations }}</span>
                <span class="stat-label">Esta Semana</span>
            </div>
            <div class="stat-card">
                <span class="stat-value">{{ statistics.monthRegistrations }}</span>
                <span class="stat-label">Este M√™s</span>
            </div>
        </div>
    </div>

    <!-- √öltimos cadastros -->
    <div class="recent-section" *ngIf="recentRegistrations.length > 0">
        <h3>üïê √öltimos Cadastros</h3>
        <div class="recent-list">
            <div class="recent-item" *ngFor="let registration of recentRegistrations">
                <span class="recent-name">{{ registration.name }}</span>
                <span class="recent-date">{{ formatDate(registration.registerDate) }}</span>
            </div>
        </div>
    </div>
</div>